<div class="profile-page-container" *ngIf="loggedInUser && currentUser">
  <div class="profile-container">
    <h2>Profil</h2>
    <table class="profile-table">
      <tr>
        <td>Név:</td>
        <td>{{ currentUser.name.firstname }} {{ currentUser.name.lastname }}</td>
      </tr>
      <tr>
        <td>Felhasználónév:</td>
        <td>{{ currentUser.username }}</td>
      </tr>
      <tr *ngIf="loggedInUser.uid === currentUser.id">
        <td>Email:</td>
        <td>{{ currentUser.email }}</td>
      </tr>
    </table>
    <form (ngSubmit)="changePassword()" *ngIf="loggedInUser.uid === currentUser.id">
        <div>
          <label for="newPassword">Új jelszó</label><br>
          <input type="password" id="newPassword" [(ngModel)]="newPassword"
                 name="newPassword" 
                 (focus)="showTooltip = true" 
                 (blur)="showTooltip = false" 
                 (ngModelChange)="onPasswordInput()">
        <div class="tooltip" [class.visible]="showTooltip">
            <p *ngIf="!passwordStrength.hasLength">Legalább 8 karakter.</p>
            <p *ngIf="!passwordStrength.hasUpperCase">Legalább egy nagybetű.</p>
            <p *ngIf="!passwordStrength.hasNumbers">Legalább egy szám.</p>
          </div>
        </div>
        <div>
            <label for="confirmPassword">Jelszó megerősítése</label><br>
            <input type="password" id="confirmPassword" [(ngModel)]="confirmPassword" 
                   name="confirmPassword"
                   (focus)="showConfirmTooltip = true" 
                   (blur)="showConfirmTooltip = false"
                   (ngModelChange)="onConfirmPasswordInput()">
            <div class="tooltip" [class.visible]="showConfirmTooltip">
              <p *ngIf="!passwordsMatch">A jelszavak nem egyeznek meg.</p>
            </div>
          </div>
        <button type="submit">Jelszó megváltoztatása</button>
    </form>
    <div class="logout-container" *ngIf="loggedInUser.uid === currentUser.id">
      <a routerLink="/login" (click)="logout()">Kijelentkezés</a>
    </div>    
  </div>

  <div class="properties-container">
    <h2>Hirdetett Ingatlanok</h2>
    <div *ngFor="let property of userProperties" class="property-item" (click)="viewPropertyDetails(property.propertyID)">
      <div class="property-image-container">
        <img *ngIf="property.photos && property.photos.length > 0" [src]="property.photos[0]" alt="Property Image" class="property-image">
        <mat-icon *ngIf="!property.photos || property.photos.length === 0" class="property-icon">image_not_supported</mat-icon>
      </div>
      <div class="property-content">
        <p class="property-price">{{ formatPrice(property.price) }}
          <span class="property-price-per-sqm">({{ calculatePricePerSqm(property.price, property.size) }} Ft / m²)</span>
        </p>
        <p class="property-address">{{ property.location }}</p>
        <div class="property-details">
          <p><strong>Alapterület:</strong> {{ property.size }} m²</p>
          <p><strong>Hálószobák száma:</strong> {{ property.features.numberOfRooms }}</p>
        </div>
      </div>
      <button mat-button (click)="$event.stopPropagation(); markAsSold(property.propertyID)" *ngIf="loggedInUser.uid === currentUser.id && !property.sold">Eladottnak nyílvánít</button>
      <button id="mat-button" mat-button (click)="$event.stopPropagation(); deleteProperty(property.propertyID)" *ngIf="loggedInUser.uid === currentUser.id">
        <mat-icon>delete</mat-icon>
      </button>
    </div>
  </div>
</div>
  